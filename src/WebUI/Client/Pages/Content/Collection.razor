@page "/content/collection"
@using BoardGameTracker.Domain.Data;

<MudPaper Elevation="25" Class="mb-2">
    <MudToolBar>
        <MudText Typo="Typo.h5">Collection</MudText>
        <MudSpacer />
        <MudTooltip Text="Import from BoardGameGeek">
            <MudIconButton Icon="@Icons.Outlined.CloudDownload"
                           Color="Color.Inherit"
                           Href="/content/import" />
        </MudTooltip>
    </MudToolBar>
</MudPaper>

<MudPaper Elevation="25" Class="mb-2">
    <MudToolBar>
        <MudTextField Clearable=true
                      Immediate=true
                      Placeholder="Search"
                      Adornment="Adornment.Start"
                      AdornmentIcon="@Icons.Material.Filled.Search"
                      IconSize="Size.Medium"
                      Class="mt-0"
                      @bind-Value="search_string" />
        <MudSpacer />
        <MudToggleIconButton Icon="@Icons.Outlined.FormatListBulleted"
                             ToggledIcon="@Icons.Outlined.GridView"
                             Color="Color.Inherit"
                             @bind-Toggled="show_table" />
    </MudToolBar>
</MudPaper>

@if (show_table)
{
    <MudTable T="BoardGame"
          Items="@games"
          Loading="@state.IsLoading"
          Filter="new Func<BoardGame,bool>(FilterFunc)"
          OnRowClick="RowClick"
          Dense=true>
        <HeaderContent>
            <MudTh>Image</MudTh>
            <MudTh><MudTableSortLabel InitialDirection="SortDirection.Ascending" SortBy="new Func<BoardGame, object>(g => g.Name)">Name</MudTableSortLabel></MudTh>
            <MudTh><MudTableSortLabel SortBy="new Func<BoardGame, object>(g => g.YearPublished)">Publication</MudTableSortLabel></MudTh>
            <MudTh><MudTableSortLabel SortBy="new Func<BoardGame, object>(g => g.MinPlayers)">Players</MudTableSortLabel></MudTh>
            <MudTh><MudTableSortLabel SortBy="new Func<BoardGame, object>(g => g.MinPlaytime)">Playtime</MudTableSortLabel></MudTh>
            <MudTh><MudTableSortLabel SortBy="new Func<BoardGame, object>(g => g.Rating)">Rating</MudTableSortLabel></MudTh>
            <MudTh><MudTableSortLabel SortBy="new Func<BoardGame, object>(g => g.Weight)">Weight</MudTableSortLabel></MudTh>
        </HeaderContent>
        <RowTemplate>
            <MudTd DataLabel="Image">
                <MudImage Src="@context.Thumbnail"
                      ObjectFit="ObjectFit.Cover"
                      Elevation="25"
                      Width="100"
                      Height="100"
                      Class="rounded-lg" />
            </MudTd>
            <MudTd DataLabel="Name">@context.Name</MudTd>
            <MudTd DataLabel="Publication">@context.YearPublished</MudTd>
            <MudTd>@context.MinPlayers-@context.MaxPlayers</MudTd>
            <MudTd>@context.MinPlaytime-@context.MaxPlaytime</MudTd>
            <MudTd>@context.Rating</MudTd>
            <MudTd>@context.Weight</MudTd>
        </RowTemplate>
        <NoRecordsContent>
            <MudText>No records found</MudText>
        </NoRecordsContent>
        <LoadingContent>
            <MudText>Loading...</MudText>
        </LoadingContent>
    </MudTable>
}
else
{
    <MudGrid>
        @foreach (var game in games)
        {
            @if (!FilterFunc(game))
                continue;

            <MudItem>
                <MudCard Class="mx-2" @onclick="(() => GameClick(game))">
                    <MudImage Src="@game.Thumbnail" Width="200" Height="200" ObjectFit="ObjectFit.Cover" />
                    <MudCardContent>
                        <MudPaper MaxWidth="160px" Elevation="0">
                            <MudText Typo="Typo.body2">@game.Name</MudText>
                            <MudStack Row=true Class="mt-2">
                                <MudStack>
                                    <MudText Typo="Typo.caption">Players</MudText>
                                    <MudText Typo="Typo.caption" Class="mt-n4">@game.MinPlayers-@game.MaxPlayers</MudText>
                                </MudStack>
                                <MudStack>
                                    <MudText Typo="Typo.caption">Playtime</MudText>
                                    <MudText Typo="Typo.caption" Class="mt-n4">@game.MinPlaytime-@game.MaxPlaytime</MudText>
                                </MudStack>
                                <MudStack>
                                    <MudText Typo="Typo.caption">Weight</MudText>
                                    <MudText Typo="Typo.caption" Class="mt-n4">@game.Weight.Substring(0,3)</MudText>
                                </MudStack>
                            </MudStack>
                        </MudPaper>
                    </MudCardContent>
                </MudCard>
            </MudItem>
        }
    </MudGrid>
}


<MudScrollToTop>
    <MudFab Color="Color.Secondary" Icon="@Icons.Filled.ArrowCircleUp" />
</MudScrollToTop>
